% Clément PAGÈS <contact@clementpages.fr>
%
% Draw basic playcards with Tikz. Inspired by https://tex.stackexchange.com/questions/47924/creating-playing-cards-using-tikz
%
% Provides cards for a4paper format
%
% Licence Gnu General Public Licence https://www.gnu.org/licenses/gpl-3.0.html
% Basic usage :
%%    \drawcardsrecto{<text><background color><fontsize><circle ray>
%%          fill an a4paper with cards
%%    \drawcardrecto{<text><background color><fontsize><circle ray>
%%          draw one card
%%    \drawcardsverso{<text>}{<fontsize}
%%          fill an a4paper with cards
%%    \drawcardverso{<text>}{<fontsize}
%%          draw one card



\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{playcards}[2023/04/27, Personal commands]

\RequirePackage{anttor}

\RequirePackage{graphicx}

\RequirePackage{tikz}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows}
\usepgflibrary {shadings} 

\RequirePackage[outline]{contour}

\pgfmathsetmacro{\cardwidth}{59}
\pgfmathsetmacro{\cardheight}{89}
\pgfmathsetmacro{\cardmargin}{4}
\pgfmathsetmacro{\cardwidthbody}{\cardwidth-\cardmargin}
\pgfmathsetmacro{\cardheightbody}{\cardheight-\cardmargin}
\pgfmathsetmacro{\stripwidth}{10}
\pgfmathsetmacro{\strippadding}{2}


\def\shapeCard{(0,0) rectangle (\cardwidth,\cardheight)}
\def\shapeCardBody{(0,0) rectangle (\cardwidthbody,\cardheightbody)}
\def\shapeMargin{(\cardmargin,\cardmargin) rectangle (\cardwidthbody,\cardheightbody)}

\tikzset{
    x=1mm,y=1mm,
    cardcorners/.style={
        rounded corners=4
    },
}

\newcommand{\carddebug}{
    \draw [step=1,help lines] (0,0) grid (\cardwidth,\cardheight);
}

\newcommand{\cardborder}{
    \draw[lightgray,cardcorners] \shapeCard;
    \draw[black,cardcorners,line width=1pt] \shapeMargin;
}

\newcommand{\cardpadding}{
    \draw[white,cardcorners] {(0,0) rectangle (\cardwidth+2,\cardheight+2)};
}


\setKVdefault[RectoKeys]{borders=true, trame=true, corners=true, backgroundImg=true}
\setKVdefault[VersoKeys]{backgroundImg=true, trame=true}


% Parameters : #1: parametres facultatifs KV
%			   #2: fontsize (pt)
%              #3: text contents
\newcommand{\cardbackgroundverso}[3][]{
    \pgfmathsetmacro{\textsize}{#3}
    \pgfmathsetmacro{\textlineskip}{1.2*\textsize}
	\clip[cardcorners] \shapeCard;
    \ifboolKV[VersoKeys]{backgroundImg} {
		\begin{scope} % Draw background
			\draw[shading=color wheel,opacity=0.6] (0,0) rectangle (\cardwidth,\cardheight);
		\end{scope}
	}{
		\draw[cardcorners, line width=1pt] \shapeCard;
	}
    \begin{scope}[shift={(0.5*\cardwidth,0.5*\cardheight)}] % White text
        \node[rotate=45, color=white] at (0,0) {\contourlength{1pt}\contour{black!}{\fontsize{\textsize pt}{\textlineskip pt}\selectfont #2}};
    \end{scope}
}

% Parameters : #1: parametres facultatifs KV
%			   #2: text contents
%              #3: background color
%              #4: fontsize (pt)
%              #5: circle ray (mm)
\newcommand{\cardcontent}[5][]{
    \pgfmathsetmacro{\textsize}{#4}
    \pgfmathsetmacro{\textlineskip}{1.2*\textsize}
    \begin{scope}
		\ifboolKV[RectoKeys]{borders} {
			\clip[cardcorners] \shapeMargin;
		}{
			\clip[cardcorners] \shapeCard;
		}
		\ifboolKV[RectoKeys]{backgroundImg} {
			\shade[xshift=29.5mm, yshift=44.5mm, inner color=#3, outer color=white] circle (\cardwidth) circle(#4);
		}
		{}
		\draw[color=white] (0,0) -- (60,70);
		\draw[color=white] (0,20) -- (60,15);
		\draw[color=white] (0,24) -- (60,30);
		\draw[color=white] (0,37) -- (60,36);
		\draw[color=white] (0,40) -- (60,60);
		\draw[color=white] (0,47) -- (60,5);
		\draw[color=white] (0,55) -- (60,45);
		\draw[color=white] (0,70) -- (40,0);
		\draw[color=white] (0,76) -- (60,65);
		\draw[color=white] (0,80) -- (25,0);
		\draw[color=white] (20,80) -- (15,0);
		\draw[color=white] (35,90) -- (0,80);
		\draw[color=white] (40,90) -- (60,-20);
		\draw[color=white] (0,5) -- (60,90);
		\draw[xshift=29.5mm, yshift=44.5mm, fill=white, color=white] circle(#5);
	\end{scope}
	\node[align=center, text width=5 cm] at (0.5*\cardwidth,0.5*\cardheight) {{\fontsize{\textsize pt}{\textlineskip pt}\selectfont #2}};
}

\newcommand{\cardcorner}[1]{
	\begin{scope}[shift={(13,76)}]
		\draw[rotate=30, fill=white, color=white] (0,0) ellipse (8 and 5) node[color=black, rotate=30]{{\fontsize{36pt}{43pt}\selectfont #1}};
	\end{scope}
	\begin{scope}[shift={(\cardwidth-13,\cardheight-76)}]
		\draw[rotate=30, fill=white, color=white] (0,0) ellipse (8 and 5) node[rotate=210, color=black]{{\fontsize{36pt}{43pt}\selectfont #1}};
	\end{scope}
}

% Parameters : #1: parametres facultatifs KV
%			   #2: text contents
%              #3: background color
%              #4: fontsize (pt)
%              #5: circle ray at card center (mm)
\newcommand{\drawcardrecto}[5][]{
	\begin{tikzpicture}
		\cardborder
		\cardpadding
		\cardcontent{#2}{#3}{#4}{#5}
		\ifboolKV[RectoKeys]{corners}{
			\cardcorner{#2}
		}{
		}
	\end{tikzpicture}%
}

% Parameters : #1: parametres facultatifs KV
%			   #2: text contents
%              #3: fontsize (pt)
\newcommand{\drawcardverso}[3][]{
	\begin{tikzpicture}%
		\cardpadding
		\cardbackgroundverso{#2}{#3}
	\end{tikzpicture}
}

% Parameters : #1: parametres facultatifs KV
%			   #2: text contents
%              #3: fontsize (pt)
\newcommand{\drawcardsverso}[3][]{
    \setKV[VersoKeys]{#1}
    \ifboolKV[VersoKeys]{trame}{
		\foreach \k in {0,...,2}{
			\foreach \n in {0,...,2}{
				\noindent\drawcardverso{#2}{#3}%
			}\\%
		}
	}{
		\noindent\drawcardverso{#2}{#3}%
	}
}

% Parameters : #1: parametres facultatives KV
%			   #2: text contents
%              #3: background color
%              #4: fontsize (pt)
%              #5: circle ray at card center (mm)
\newcommand{\drawcardsrecto}[5][] {
	\setKV[RectoKeys]{#1}
	\ifboolKV[RectoKeys]{trame}{
		\foreach \k in {0,...,2}{
			\foreach \n in {0,...,2}{
				\noindent\drawcardrecto{#2}{#3}{#4}{#5}%
			}\\%
		}
	}{
		\noindent\drawcardrecto{#2}{#3}{#4}{#5}%
	}
}
